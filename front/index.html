<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotizador de Construcci√≥n - Costa Rica</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0033A0 0%, #CE1126 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #0033A0 0%, #CE1126 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #0033A0;
            box-shadow: 0 0 0 3px rgba(0, 51, 160, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #0033A0 0%, #CE1126 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 51, 160, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            box-shadow: 0 5px 20px rgba(108, 117, 125, 0.4);
        }

        /* Added construction type selection cards */
        .construction-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .type-card {
            background: white;
            border: 3px solid #e9ecef;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .type-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .type-card.selected {
            border-color: #0033A0;
            background: #f0f7ff;
            box-shadow: 0 5px 20px rgba(0, 51, 160, 0.2);
        }

        .type-card input[type="radio"] {
            display: none;
        }

        .type-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .type-card h3 {
            color: #0033A0;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .type-card p {
            color: #6c757d;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .category {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #e9ecef;
        }

        .category h3 {
            color: #0033A0;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
        }

        .category h3::before {
            content: "‚ñ∏";
            margin-right: 10px;
            font-size: 1.2em;
        }

        .material-option {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s;
        }

        .material-option:hover {
            border-color: #0033A0;
            transform: translateX(5px);
        }

        .material-option.selected {
            border-color: #0033A0;
            background: #f0f7ff;
        }

        .material-option input[type="radio"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }

        .material-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .material-name {
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
            flex: 1;
        }

        .material-price {
            color: #28a745;
            font-weight: 600;
            font-size: 1.1em;
        }

        .material-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e9ecef;
            color: #6c757d;
            font-size: 0.95em;
        }

        .result-section {
            background: linear-gradient(135deg, #0033A0 0%, #CE1126 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
        }

        .result-section h2 {
            margin-bottom: 20px;
            font-size: 2em;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .summary-card h4 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .summary-card .value {
            font-size: 2em;
            font-weight: 700;
        }

        .detail-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            color: #333;
        }

        .detail-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .detail-table th {
            background: #0033A0;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .detail-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-table tr:last-child td {
            border-bottom: none;
        }

        .detail-table tr:hover {
            background: #f8f9fa;
        }

        .category-total {
            background: #e9ecef;
            font-weight: 700;
            color: #0033A0;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        @media print {
            body {
                background: white;
            }
            .btn {
                display: none;
            }
        }

        .progress-bar {
            background: #e9ecef;
            height: 6px;
            border-radius: 3px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #0033A0 0%, #CE1126 100%);
            height: 100%;
            transition: width 0.3s;
        }

        .step-indicator {
            text-align: center;
            margin-bottom: 30px;
            color: #6c757d;
            font-size: 1.1em;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #0033A0;
            padding: 15px 20px;
            margin-bottom: 25px;
            border-radius: 5px;
        }

        .info-box p {
            color: #0066cc;
            margin: 0;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Cotizador de Construcci√≥n</h1>
            <p>Sistema profesional de cotizaci√≥n para proyectos en Costa Rica</p>
        </div>

        <div class="content">
            <!-- Step 1: Datos b√°sicos y tipo de construcci√≥n -->
            <div class="step active" id="step1">
                <h2 style="margin-bottom: 30px;">Paso 1: Datos del Proyecto</h2>
                
                <!-- Added construction type selection -->
                <div class="form-group">
                    <label>Tipo de Construcci√≥n</label>
                    <div class="info-box">
                        <p>Seleccione el tipo de construcci√≥n seg√∫n sus necesidades. Cada tipo influye en los materiales disponibles y costos del proyecto.</p>
                    </div>
                    <div class="construction-types">
                        <label class="type-card" id="type-liviano-card">
                            <input type="radio" name="constructionType" value="liviano" id="type-liviano">
                            <div class="type-icon">üè†</div>
                            <h3>Construcci√≥n Liviana</h3>
                            <p>Ideal para ampliaciones, anexos o construcciones temporales. Utiliza materiales ligeros como madera y metal.</p>
                        </label>
                        
                        <label class="type-card" id="type-madera-card">
                            <input type="radio" name="constructionType" value="madera" id="type-madera">
                            <div class="type-icon">üå≤</div>
                            <h3>Construcci√≥n en Madera</h3>
                            <p>Construcci√≥n tradicional con madera tratada. Est√©tica natural, r√°pida instalaci√≥n y excelente aislamiento t√©rmico.</p>
                        </label>
                        
                        <label class="type-card" id="type-cemento-card">
                            <input type="radio" name="constructionType" value="cemento" id="type-cemento">
                            <div class="type-icon">üèóÔ∏è</div>
                            <h3>Construcci√≥n en Cemento</h3>
                            <p>Construcci√≥n s√≥lida y duradera. M√°xima resistencia estructural, ideal para viviendas permanentes y edificios.</p>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="area">√Årea total de construcci√≥n (m¬≤)</label>
                    <input type="number" id="area" placeholder="Ej: 100" min="1" required>
                </div>

                <div class="form-group">
                    <label for="pisos">N√∫mero de pisos</label>
                    <input type="number" id="pisos" placeholder="Ej: 2" min="1" max="5" required>
                </div>

                <div class="form-group">
                    <label for="altura">Altura de cielos (metros)</label>
                    <input type="number" id="altura" placeholder="Ej: 2.5" step="0.1" min="2" max="4" required>
                </div>

                <div class="form-group">
                    <label for="banos">N√∫mero de ba√±os</label>
                    <input type="number" id="banos" placeholder="Ej: 2" min="1" max="10" required>
                </div>

                <button class="btn" onclick="goToMaterialSelection()">Continuar a Selecci√≥n de Materiales ‚Üí</button>
            </div>

            <!-- Step 2: Selecci√≥n de materiales -->
            <div class="step" id="step2">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 50%;"></div>
                </div>

                <div class="step-indicator">Paso 2 de 3: Seleccione los materiales para cada secci√≥n</div>

                <h2 style="margin-bottom: 30px;">Selecci√≥n de Materiales por Secci√≥n</h2>
                
                <div id="material-selection-container"></div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="goToStep1()">‚Üê Volver</button>
                    <button class="btn" onclick="generateQuote()">Generar Cotizaci√≥n Final ‚Üí</button>
                </div>
            </div>

            <!-- Step 3: Resultados -->
            <div class="step" id="step3">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 100%;"></div>
                </div>

                <div class="step-indicator">Paso 3 de 3: Cotizaci√≥n Final</div>

                <div id="results-container"></div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="goToStep2()">‚Üê Modificar Materiales</button>
                    <button class="btn" onclick="window.print()">Imprimir</button>
                    <button class="btn" onclick="downloadPDF()">Descargar PDF</button>
                    <button class="btn" onclick="guardarCotizacion()">Guardar Cotizaci√≥n</button>

                    <script>
                        async function guardarCotizacion() {
                            try {
                                console.log("Entr√≥ a guardarCotizacion");
                        
                                const cotizacion = {
                                    proyecto_id: document.getElementById("tipoConstruccion").value,
                                    total: Number(document.getElementById("totalCosto").value)
                                };
                        
                                console.log("Datos enviados:", cotizacion);
                        
                                const response = await fetch("https://proyecto-relampago-ejt1.onrender.com/api/cotizacion", {
                                    method: "POST",
                                    headers: { "Content-Type": "application/json" },
                                    body: JSON.stringify(cotizacion)
                                });
                        
                                console.log("Status:", response.status);
                        
                                if (!response.ok) {
                                    alert("Error guardando la cotizaci√≥n");
                                    return;
                                }
                        
                                alert("Cotizaci√≥n guardada correctamente");
                            } catch (err) {
                                console.log("Error:", err);
                                alert("Error de conexi√≥n");
                            }
                        }
                        </script>
    <script>
        const materialsDatabase = {
            // Estructura base - var√≠a seg√∫n tipo de construcci√≥n
            estructura: {
                name: "Estructura y Cimentaci√≥n",
                items: {
                    liviano: [
                        {
                            category: "Base y Pilares",
                            options: [
                                { id: "pilar_metalico", name: "Pilares met√°licos galvanizados", unit: "unidad 3m", price: 28000, factor: 0.3 },
                                { id: "pilar_aluminio", name: "Pilares de aluminio", unit: "unidad 3m", price: 35000, factor: 0.3 }
                            ]
                        },
                        {
                            category: "Vigas",
                            options: [
                                { id: "viga_metalica_liviana", name: "Viga met√°lica liviana", unit: "unidad 4m", price: 18000, factor: 0.5 },
                                { id: "perfil_c", name: "Perfil C met√°lico", unit: "unidad 6m", price: 22000, factor: 0.4 }
                            ]
                        }
                    ],
                    madera: [
                        {
                            category: "Cimentaci√≥n",
                            options: [
                                { id: "cemento_base", name: "Cemento para base", unit: "saco 50kg", price: 6200, factor: 0.08 },
                                { id: "piedra_base", name: "Piedra para base", unit: "m¬≥", price: 20000, factor: 0.05 }
                            ]
                        },
                        {
                            category: "Estructura Principal",
                            options: [
                                { id: "madera_laurel", name: "Madera de laurel tratada", unit: "pieza 4x4x3m", price: 45000, factor: 0.2 },
                                { id: "madera_melina", name: "Madera de melina tratada", unit: "pieza 4x4x3m", price: 32000, factor: 0.2 },
                                { id: "madera_pino", name: "Madera de pino tratado", unit: "pieza 4x4x3m", price: 38000, factor: 0.2 }
                            ]
                        },
                        {
                            category: "Vigas",
                            options: [
                                { id: "viga_madera_4x6", name: "Viga de madera 4x6", unit: "pieza 4m", price: 28000, factor: 0.4 },
                                { id: "viga_madera_4x8", name: "Viga de madera 4x8", unit: "pieza 4m", price: 35000, factor: 0.4 }
                            ]
                        }
                    ],
                    cemento: [
                        {
                            category: "Cemento",
                            options: [
                                { id: "cemento_gris", name: "Cemento gris est√°ndar", unit: "saco 50kg", price: 6200, factor: 0.15 },
                                { id: "cemento_blanco", name: "Cemento blanco premium", unit: "saco 50kg", price: 9800, factor: 0.15 },
                                { id: "cemento_rapido", name: "Cemento de fraguado r√°pido", unit: "saco 50kg", price: 8500, factor: 0.15 }
                            ]
                        },
                        {
                            category: "Arena",
                            options: [
                                { id: "arena_rio", name: "Arena de r√≠o", unit: "m¬≥", price: 18000, factor: 0.08 },
                                { id: "arena_lavada", name: "Arena lavada", unit: "m¬≥", price: 22000, factor: 0.08 }
                            ]
                        },
                        {
                            category: "Piedra",
                            options: [
                                { id: "piedra_cuarta", name: "Piedra cuarta", unit: "m¬≥", price: 22000, factor: 0.10 },
                                { id: "piedra_quinta", name: "Piedra quinta", unit: "m¬≥", price: 20000, factor: 0.10 }
                            ]
                        },
                        {
                            category: "Varilla",
                            options: [
                                { id: "varilla_3_8", name: "Varilla corrugada 3/8", unit: "vara 6m", price: 4800, factor: 0.8 },
                                { id: "varilla_1_2", name: "Varilla corrugada 1/2", unit: "vara 6m", price: 7200, factor: 0.8 }
                            ]
                        }
                    ]
                }
            },
            
            // Paredes - var√≠a seg√∫n tipo de construcci√≥n
            paredes: {
                name: "Paredes y Cerramientos",
                items: {
                    liviano: [
                        {
                            category: "Paredes",
                            options: [
                                { id: "panel_metalico", name: "Panel met√°lico prepintado", unit: "m¬≤", price: 12500, factor: 1 },
                                { id: "lamina_acanalada", name: "L√°mina acanalada", unit: "l√°mina", price: 8500, factor: 4 },
                                { id: "panel_sandwich", name: "Panel s√°ndwich t√©rmico", unit: "m¬≤", price: 18500, factor: 1 }
                            ]
                        }
                    ],
                    madera: [
                        {
                            category: "Paredes",
                            options: [
                                { id: "tabla_machihembrada", name: "Tabla machihembrada", unit: "m¬≤", price: 15500, factor: 1 },
                                { id: "madera_pino_pared", name: "Tabla de pino cepillada", unit: "m¬≤", price: 12000, factor: 1 },
                                { id: "panel_osb", name: "Panel OSB estructural", unit: "l√°mina 4x8", price: 22000, factor: 0.15 }
                            ]
                        },
                        {
                            category: "Aislamiento",
                            options: [
                                { id: "aislante_fibra", name: "Aislante de fibra de vidrio", unit: "rollo", price: 18500, factor: 0.08 },
                                { id: "aislante_espuma", name: "Aislante de espuma r√≠gida", unit: "l√°mina", price: 12500, factor: 0.12 }
                            ]
                        }
                    ],
                    cemento: [
                        {
                            category: "Material de pared",
                            options: [
                                { id: "ladrillo_barro", name: "Ladrillo de barro tradicional", unit: "unidad", price: 280, factor: 80 },
                                { id: "block_concreto", name: "Block de concreto 15cm", unit: "unidad", price: 720, factor: 60 },
                                { id: "ladrillo_bloque", name: "Ladrillo bloque prensado", unit: "unidad", price: 450, factor: 70 }
                            ]
                        },
                        {
                            category: "Mezcla",
                            options: [
                                { id: "mortero_preparado", name: "Mezcla preparada", unit: "saco 40kg", price: 4200, factor: 0.3 },
                                { id: "mortero_tradicional", name: "Mortero tradicional", unit: "saco", price: 3500, factor: 0.35 }
                            ]
                        }
                    ]
                }
            },

            // Techo - disponible para todos los tipos
            techo: {
                name: "Techo y Cubierta",
                items: {
                    liviano: [
                        {
                            category: "Estructura de techo",
                            options: [
                                { id: "cercha_metalica_liviana", name: "Cercha met√°lica liviana", unit: "unidad", price: 85000, factor: 0.1 },
                                { id: "perfil_techo", name: "Perfil met√°lico para techo", unit: "unidad 6m", price: 15000, factor: 0.6 }
                            ]
                        },
                        {
                            category: "Cubierta",
                            options: [
                                { id: "lamina_zinc", name: "L√°mina de zinc galvanizada", unit: "l√°mina", price: 12500, factor: 3 },
                                { id: "lamina_aluminio", name: "L√°mina de aluminio", unit: "l√°mina", price: 18500, factor: 3 }
                            ]
                        }
                    ],
                    madera: [
                        {
                            category: "Estructura de techo",
                            options: [
                                { id: "viga_madera_techo", name: "Viga de madera para techo", unit: "pieza 5m", price: 28000, factor: 0.4 },
                                { id: "cercha_madera", name: "Cercha de madera prefabricada", unit: "unidad", price: 95000, factor: 0.08 }
                            ]
                        },
                        {
                            category: "Cubierta",
                            options: [
                                { id: "lamina_zinc", name: "L√°mina de zinc galvanizada", unit: "l√°mina", price: 12500, factor: 3 },
                                { id: "teja_barro", name: "Teja de barro", unit: "unidad", price: 1850, factor: 15 },
                                { id: "teja_asfaltica", name: "Teja asf√°ltica", unit: "m¬≤", price: 8500, factor: 1.1 }
                            ]
                        }
                    ],
                    cemento: [
                        {
                            category: "Estructura de techo",
                            options: [
                                { id: "viga_metalica", name: "Viga met√°lica", unit: "unidad 5m", price: 35000, factor: 0.4 },
                                { id: "cercha_metalica", name: "Cercha met√°lica prefabricada", unit: "unidad", price: 125000, factor: 0.08 }
                            ]
                        },
                        {
                            category: "Cubierta",
                            options: [
                                { id: "lamina_zinc", name: "L√°mina de zinc galvanizada", unit: "l√°mina", price: 12500, factor: 3 },
                                { id: "teja_barro", name: "Teja de barro", unit: "unidad", price: 1850, factor: 15 },
                                { id: "teja_asfaltica", name: "Teja asf√°ltica", unit: "m¬≤", price: 8500, factor: 1.1 }
                            ]
                        },
                        {
                            category: "Impermeabilizante",
                            options: [
                                { id: "impermeabilizante_acrilico", name: "Impermeabilizante acr√≠lico", unit: "cubeta 19L", price: 42000, factor: 0.04 },
                                { id: "impermeabilizante_fibrado", name: "Impermeabilizante fibrado", unit: "cubeta 19L", price: 56000, factor: 0.04 }
                            ]
                        }
                    ]
                }
            },

            // Pisos - disponible para todos los tipos
            pisos: {
                name: "Pisos y Acabados",
                items: {
                    all: [
                        {
                            category: "Piso",
                            options: [
                                { id: "ceramica_estandar", name: "Cer√°mica est√°ndar", unit: "m¬≤", price: 9500, factor: 1 },
                                { id: "ceramica_premium", name: "Cer√°mica premium", unit: "m¬≤", price: 16500, factor: 1 },
                                { id: "porcelanato", name: "Porcelanato", unit: "m¬≤", price: 24000, factor: 1 },
                                { id: "piso_laminado", name: "Piso laminado", unit: "m¬≤", price: 18500, factor: 1 },
                                { id: "piso_madera", name: "Piso de madera natural", unit: "m¬≤", price: 32000, factor: 1 }
                            ]
                        },
                        {
                            category: "Pegamento",
                            options: [
                                { id: "pegamento_normal", name: "Pegamento est√°ndar", unit: "saco 20kg", price: 6800, factor: 0.15 },
                                { id: "pegamento_flexible", name: "Pegamento flexible premium", unit: "saco 20kg", price: 9500, factor: 0.15 }
                            ]
                        }
                    ]
                }
            },

            // Instalaci√≥n el√©ctrica - com√∫n para todos
            electrica: {
                name: "Instalaci√≥n El√©ctrica",
                items: {
                    all: [
                        {
                            category: "Cable el√©ctrico",
                            options: [
                                { id: "cable_thhn_12", name: "Cable THHN calibre 12", unit: "metro", price: 680, factor: 2 },
                                { id: "cable_thhn_14", name: "Cable THHN calibre 14", unit: "metro", price: 450, factor: 1.5 }
                            ]
                        },
                        {
                            category: "Interruptores",
                            options: [
                                { id: "apagador_basico", name: "Interruptor sencillo b√°sico", unit: "unidad", price: 1850, factor: 0.15 },
                                { id: "apagador_premium", name: "Interruptor t√°ctil premium", unit: "unidad", price: 4500, factor: 0.15 }
                            ]
                        },
                        {
                            category: "Luminarias",
                            options: [
                                { id: "lampara_led_basica", name: "Luminaria LED b√°sica", unit: "unidad", price: 8500, factor: 0.12 },
                                { id: "lampara_led_empotrar", name: "Panel LED empotrable", unit: "unidad", price: 12500, factor: 0.12 }
                            ]
                        }
                    ]
                }
            },

            // Instalaci√≥n hidr√°ulica - com√∫n para todos
            hidraulica: {
                name: "Instalaci√≥n Hidr√°ulica",
                items: {
                    all: [
                        {
                            category: "Tuber√≠a",
                            options: [
                                { id: "pvc_normal", name: "Tuber√≠a PVC 1/2 est√°ndar", unit: "vara 6m", price: 3800, factor: 0.25 },
                                { id: "pvc_presion", name: "Tuber√≠a PVC 1/2 alta presi√≥n", unit: "vara 6m", price: 5200, factor: 0.25 }
                            ]
                        },
                        {
                            category: "Inodoro",
                            options: [
                                { id: "inodoro_basico", name: "Inodoro b√°sico completo", unit: "unidad", price: 95000, per: "bathroom" },
                                { id: "inodoro_ahorro", name: "Inodoro ahorro de agua", unit: "unidad", price: 125000, per: "bathroom" }
                            ]
                        },
                        {
                            category: "Lavamanos",
                            options: [
                                { id: "lavamanos_basico", name: "Lavamanos con grifer√≠a b√°sica", unit: "unidad", price: 85000, per: "bathroom" },
                                { id: "lavamanos_mueble", name: "Lavamanos con mueble", unit: "unidad", price: 185000, per: "bathroom" }
                            ]
                        },
                        {
                            category: "Ducha",
                            options: [
                                { id: "ducha_electrica", name: "Ducha el√©ctrica b√°sica", unit: "unidad", price: 45000, per: "bathroom" },
                                { id: "ducha_premium", name: "Ducha el√©ctrica premium", unit: "unidad", price: 85000, per: "bathroom" }
                            ]
                        },
                        {
                            category: "Tanque de agua",
                            options: [
                                { id: "tanque_600", name: "Tanque 600 litros", unit: "unidad", price: 185000, factor: 1 },
                                { id: "tanque_1100", name: "Tanque 1100 litros", unit: "unidad", price: 285000, factor: 1 }
                            ]
                        }
                    ]
                }
            },

            // Acabados - var√≠a seg√∫n tipo
            acabados: {
                name: "Acabados y Pintura",
                items: {
                    liviano: [
                        {
                            category: "Pintura",
                            options: [
                                { id: "pintura_metal", name: "Pintura para metal anticorrosivo", unit: "gal√≥n", price: 18500, factor: 0.025 },
                                { id: "pintura_exterior", name: "Pintura exterior", unit: "gal√≥n", price: 16500, factor: 0.025 }
                            ]
                        }
                    ],
                    madera: [
                        {
                            category: "Acabado para madera",
                            options: [
                                { id: "barniz_natural", name: "Barniz natural brillante", unit: "gal√≥n", price: 22000, factor: 0.02 },
                                { id: "barniz_mate", name: "Barniz mate protector", unit: "gal√≥n", price: 19500, factor: 0.02 },
                                { id: "lasur_color", name: "Lasur con color", unit: "gal√≥n", price: 24500, factor: 0.02 }
                            ]
                        },
                        {
                            category: "Sellador",
                            options: [
                                { id: "sellador_madera", name: "Sellador para madera", unit: "gal√≥n", price: 16500, factor: 0.015 }
                            ]
                        }
                    ],
                    cemento: [
                        {
                            category: "Repello",
                            options: [
                                { id: "repello_fino", name: "Repello fino", unit: "saco 40kg", price: 4800, factor: 0.2 },
                                { id: "repello_grueso", name: "Repello grueso", unit: "saco 40kg", price: 3800, factor: 0.25 }
                            ]
                        },
                        {
                            category: "Pintura",
                            options: [
                                { id: "pintura_latex", name: "Pintura l√°tex est√°ndar", unit: "gal√≥n", price: 14500, factor: 0.03 },
                                { id: "pintura_premium", name: "Pintura premium lavable", unit: "gal√≥n", price: 22000, factor: 0.03 }
                            ]
                        }
                    ]
                }
            },

            // Puertas y ventanas - com√∫n para todos
            puertas_ventanas: {
                name: "Puertas y Ventanas",
                items: {
                    all: [
                        {
                            category: "Puertas",
                            options: [
                                { id: "puerta_madera", name: "Puerta de madera sencilla", unit: "unidad", price: 85000, factor: 0.08 },
                                { id: "puerta_metalica", name: "Puerta met√°lica", unit: "unidad", price: 125000, factor: 0.08 },
                                { id: "puerta_tambor", name: "Puerta tipo tambor", unit: "unidad", price: 65000, factor: 0.08 }
                            ]
                        },
                        {
                            category: "Ventanas",
                            options: [
                                { id: "ventana_aluminio", name: "Ventana de aluminio natural", unit: "m¬≤", price: 45000, factor: 0.15 },
                                { id: "ventana_aluminio_vidrio", name: "Ventana aluminio + vidrio", unit: "m¬≤", price: 65000, factor: 0.15 },
                                { id: "ventana_pvc", name: "Ventana PVC", unit: "m¬≤", price: 85000, factor: 0.15 }
                            ]
                        }
                    ]
                }
            }
        };

        let projectData = {};
        let selectedMaterials = {};

        document.addEventListener('DOMContentLoaded', function() {
            // Handle construction type selection
            const typeCards = document.querySelectorAll('.type-card');
            typeCards.forEach(card => {
                card.addEventListener('click', function() {
                    typeCards.forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    this.querySelector('input[type="radio"]').checked = true;
                });
            });
        });

        function goToMaterialSelection() {
            const area = parseFloat(document.getElementById('area').value);
            const pisos = parseInt(document.getElementById('pisos').value);
            const altura = parseFloat(document.getElementById('altura').value);
            const banos = parseInt(document.getElementById('banos').value);
            const constructionType = document.querySelector('input[name="constructionType"]:checked');

            if (!area || !pisos || !altura || !banos) {
                alert('Por favor complete todos los campos b√°sicos');
                return;
            }

            if (!constructionType) {
                alert('Por favor seleccione un tipo de construcci√≥n');
                return;
            }

            projectData = {
                area: area,
                pisos: pisos,
                altura: altura,
                banos: banos,
                constructionType: constructionType.value
            };

            renderMaterialSelection();
            goToStep2();
        }

        function renderMaterialSelection() {
            const container = document.getElementById('material-selection-container');
            container.innerHTML = '';

            Object.keys(materialsDatabase).forEach(sectionKey => {
                const section = materialsDatabase[sectionKey];
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';

                let html = `<h3>${section.name}</h3>`;

                // Get items based on construction type
                let items = section.items[projectData.constructionType] || section.items['all'] || [];

                items.forEach((itemGroup, groupIndex) => {
                    html += `<h4 style="color: #333; margin: 20px 0 15px 0;">${itemGroup.category}</h4>`;
                    
                    itemGroup.options.forEach((option, optionIndex) => {
                        const quantity = calculateQuantity(option, projectData);
                        const subtotal = quantity * option.price;
                        const isSelected = selectedMaterials[sectionKey + '_' + itemGroup.category] === option.id;

                        html += `
                            <div class="material-option ${isSelected ? 'selected' : ''}" onclick="selectMaterial('${sectionKey}', '${itemGroup.category}', '${option.id}', this)">
                                <div class="material-header">
                                    <input type="radio" name="${sectionKey}_${itemGroup.category}" value="${option.id}" ${isSelected ? 'checked' : ''}>
                                    <span class="material-name">${option.name}</span>
                                    <span class="material-price">‚Ç°${option.price.toLocaleString('es-CR')}</span>
                                </div>
                                <div class="material-details">
                                    <div><strong>Recomendado:</strong> ${quantity.toFixed(2)} ${option.unit}</div>
                                    <div><strong>Unidad:</strong> ${option.unit}</div>
                                    <div><strong>Subtotal:</strong> ‚Ç°${subtotal.toLocaleString('es-CR')}</div>
                                </div>
                            </div>
                        `;
                    });
                });

                categoryDiv.innerHTML = html;
                container.appendChild(categoryDiv);
            });
        }

        function selectMaterial(section, category, optionId, element) {
            const key = section + '_' + category;
            selectedMaterials[key] = optionId;
            
            const parentCategory = element.closest('.category');
            parentCategory.querySelectorAll('.material-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        function calculateQuantity(material, data) {
            if (material.per === 'bathroom') {
                return data.banos;
            } else if (material.factor) {
                return material.factor * data.area * data.pisos;
            }
            return 0;
        }

        function generateQuote() {
            if (Object.keys(selectedMaterials).length === 0) {
                alert('Por favor seleccione al menos un material de cada categor√≠a');
                return;
            }

            const results = [];
            let grandTotal = 0;

            Object.keys(materialsDatabase).forEach(sectionKey => {
                const section = materialsDatabase[sectionKey];
                const items = section.items[projectData.constructionType] || section.items['all'] || [];
                
                items.forEach(itemGroup => {
                    const key = sectionKey + '_' + itemGroup.category;
                    const selectedId = selectedMaterials[key];
                    
                    if (selectedId) {
                        const material = itemGroup.options.find(opt => opt.id === selectedId);
                        if (material) {
                            const quantity = calculateQuantity(material, projectData);
                            const subtotal = quantity * material.price;
                            grandTotal += subtotal;

                            results.push({
                                category: section.name,
                                subcategory: itemGroup.category,
                                material: material.name,
                                quantity: quantity,
                                unit: material.unit,
                                unitPrice: material.price,
                                subtotal: subtotal
                            });
                        }
                    }
                });
            });

            renderResults(results, grandTotal);
            goToStep3();
        }

        function renderResults(results, grandTotal) {
            const container = document.getElementById('results-container');
            
            let html = `
                <div class="result-section">
                    <h2>Cotizaci√≥n Final - Construcci√≥n Tipo: ${projectData.constructionType.charAt(0).toUpperCase() + projectData.constructionType.slice(1)}</h2>
                    
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h4>√ÅREA TOTAL</h4>
                            <div class="value">${projectData.area} m¬≤</div>
                        </div>
                        <div class="summary-card">
                            <h4>N√öMERO DE PISOS</h4>
                            <div class="value">${projectData.pisos}</div>
                        </div>
                        <div class="summary-card">
                            <h4>BA√ëOS</h4>
                            <div class="value">${projectData.banos}</div>
                        </div>
                        <div class="summary-card">
                            <h4>TOTAL ESTIMADO</h4>
                            <div class="value">‚Ç°${grandTotal.toLocaleString('es-CR')}</div>
                        </div>
                    </div>

                    <div class="detail-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Secci√≥n</th>
                                    <th>Categor√≠a</th>
                                    <th>Material</th>
                                    <th>Cantidad</th>
                                    <th>Precio Unit.</th>
                                    <th>Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            let currentCategory = '';
            let categoryTotal = 0;

            results.forEach((item, index) => {
                if (currentCategory && currentCategory !== item.category) {
                    html += `
                        <tr class="category-total">
                            <td colspan="5" style="text-align: right;"><strong>Subtotal ${currentCategory}:</strong></td>
                            <td><strong>‚Ç°${categoryTotal.toLocaleString('es-CR')}</strong></td>
                        </tr>
                    `;
                    categoryTotal = 0;
                }

                currentCategory = item.category;
                categoryTotal += item.subtotal;

                html += `
                    <tr>
                        <td>${item.category}</td>
                        <td>${item.subcategory}</td>
                        <td>${item.material}</td>
                        <td>${item.quantity.toFixed(2)} ${item.unit}</td>
                        <td>‚Ç°${item.unitPrice.toLocaleString('es-CR')}</td>
                        <td>‚Ç°${item.subtotal.toLocaleString('es-CR')}</td>
                    </tr>
                `;
            });

            html += `
                        <tr class="category-total">
                            <td colspan="5" style="text-align: right;"><strong>Subtotal ${currentCategory}:</strong></td>
                            <td><strong>‚Ç°${categoryTotal.toLocaleString('es-CR')}</strong></td>
                        </tr>
                        <tr style="background: #0033A0; color: white; font-size: 1.2em;">
                            <td colspan="5" style="text-align: right; padding: 20px;"><strong>TOTAL GENERAL:</strong></td>
                            <td style="padding: 20px;"><strong>‚Ç°${grandTotal.toLocaleString('es-CR')}</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
            `;

            container.innerHTML = html;
        }

        function goToStep1() {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step1').classList.add('active');
        }

        function goToStep2() {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step2').classList.add('active');
        }

        function goToStep3() {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step3').classList.add('active');
        }

        function downloadPDF() {
            window.print();
        }
    </script>
</body>
</html>
